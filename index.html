<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vercel Pro Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.11/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.11/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.11/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.11/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #050505; color: #fff; overflow-x: hidden; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .aurora { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(circle at 50% -20%, #1e1e1e, #050505); }
        .CodeMirror { height: 300px; border-radius: 12px; font-size: 14px; border: 1px solid rgba(255,255,255,0.1); }
        .loading-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .tab-active { border-bottom: 2px solid #fff; color: #fff; }
    </style>
</head>
<body class="pb-20">
    <div class="aurora"></div>

    <nav class="border-b border-white/10 py-4 px-6 mb-8 glass sticky top-0 z-50">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold flex items-center gap-2">
                <i class="fa-solid fa-shapes text-blue-500"></i> Vercel Pro Suite
            </h1>
            <div class="flex gap-6 text-sm font-medium text-gray-400">
                <button onclick="switchTab('deploy')" id="tab-deploy" class="pb-1 tab-active transition-all">Deploy</button>
                <button onclick="switchTab('history')" id="tab-history" class="pb-1 transition-all">Management</button>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-4">
        
        <div id="section-deploy" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="glass rounded-3xl p-8 space-y-6">
                <h2 class="text-lg font-bold uppercase tracking-widest text-gray-500">New Deployment</h2>
                
                <div class="space-y-4">
                    <input type="password" id="token" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-sm focus:border-white outline-none transition" placeholder="Vercel API Token (pfx_...)">
                    <input type="text" id="projectName" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-sm focus:border-white outline-none transition" placeholder="Project Name (subdomain)">
                    
                    <div class="flex items-center gap-4 p-4 bg-white/5 rounded-xl border border-white/10">
                        <div class="flex-grow">
                            <p class="text-xs font-bold text-gray-400 mb-1">Upload index.html / .zip</p>
                            <input type="file" id="fileInput" accept=".html,.zip" class="text-xs text-gray-500">
                        </div>
                        <i class="fa-solid fa-file-zipper text-2xl text-gray-600"></i>
                    </div>

                    <div id="editorContainer" class="hidden animate-in fade-in duration-500">
                        <p class="text-xs font-bold text-gray-400 mb-2">Live Editor (Preview index.html)</p>
                        <textarea id="codeEditor"></textarea>
                    </div>

                    <button id="deployBtn" onclick="mulaiDeploy()" class="w-full bg-white text-black py-4 rounded-xl font-black uppercase tracking-tighter hover:bg-blue-500 hover:text-white transition-all active:scale-95 flex items-center justify-center gap-3">
                        Luncurkan Web <i class="fa-solid fa-bolt"></i>
                    </button>
                </div>
            </div>

            <div class="hidden lg:flex flex-col justify-center items-center text-center p-8 border-2 border-dashed border-white/10 rounded-3xl">
                <div class="w-20 h-20 bg-white/5 rounded-full flex items-center justify-center mb-4">
                    <i class="fa-solid fa-earth-asia text-3xl text-gray-600"></i>
                </div>
                <h3 class="text-xl font-bold mb-2" id="prevTitle">Siap Beraksi?</h3>
                <p class="text-gray-500 text-sm max-w-xs">Domain: <span class="text-blue-400 font-mono" id="prevDomain">...</span></p>
            </div>
        </div>

        <div id="section-history" class="hidden animate-in slide-in-from-bottom-5 duration-500">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="historyGrid">
                </div>
        </div>

    </main>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 glass px-6 py-3 rounded-full hidden flex items-center gap-3 border-white/20 shadow-2xl">
        <i class="fa-solid fa-circle-notch loading-spin text-blue-500"></i>
        <span id="toastText" class="text-sm font-medium">Memproses...</span>
    </div>

    <script>
        let editor;
        let historyData = JSON.parse(localStorage.getItem('vercel_suite_history')) || [];

        // Inisialisasi Code Editor
        window.onload = () => {
            editor = CodeMirror.fromTextArea(document.getElementById("codeEditor"), {
                mode: "xml",
                theme: "dracula",
                lineNumbers: true,
            });
            renderHistory();
        };

        // File Reader untuk Editor & ZIP
        document.getElementById('fileInput').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file && file.name.endsWith('.html')) {
                const text = await file.text();
                document.getElementById('editorContainer').classList.remove('hidden');
                editor.setValue(text);
            } else {
                document.getElementById('editorContainer').classList.add('hidden');
            }
        });

        // Tab Switcher
        function switchTab(tab) {
            document.getElementById('section-deploy').classList.toggle('hidden', tab !== 'deploy');
            document.getElementById('section-history').classList.toggle('hidden', tab !== 'history');
            document.getElementById('tab-deploy').className = tab === 'deploy' ? 'pb-1 tab-active' : 'pb-1';
            document.getElementById('tab-history').className = tab === 'history' ? 'pb-1 tab-active' : 'pb-1';
        }

        async function mulaiDeploy() {
            const token = document.getElementById('token').value;
            const projectName = document.getElementById('projectName').value.trim().toLowerCase().replace(/\s+/g, '-');
            const fileInput = document.getElementById('fileInput');
            const btn = document.getElementById('deployBtn');

            if(!token || !projectName || !fileInput.files[0]) return alert("Data tidak lengkap!");

            showToast("ðŸš€ Menyiapkan berkas...");
            btn.disabled = true;

            try {
                let filesToDeploy = [];
                const file = fileInput.files[0];

                if (file.name.endsWith('.zip')) {
                    // FITUR 3: Support ZIP
                    const zip = await JSZip.loadAsync(file);
                    for (const [filename, fileObj] of Object.entries(zip.files)) {
                        if (!fileObj.dir) {
                            const content = await fileObj.async("string");
                            filesToDeploy.push({ file: filename, data: content });
                        }
                    }
                } else {
                    // FITUR 2: Ambil dari Editor jika HTML
                    const content = editor.getValue() || await file.text();
                    filesToDeploy.push({ file: "index.html", data: content });
                }

                showToast("ðŸ›°ï¸ Mengirim ke Vercel...");
                const response = await fetch('https://api.vercel.com/v13/deployments', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: projectName,
                        files: filesToDeploy,
                        projectSettings: { framework: null },
                        target: 'production'
                    })
                });

                const result = await response.json();
                if (response.ok) {
                    showToast("âœ… Berhasil Dideploy!");
                    saveHistory(projectName, result.id, token);
                    setTimeout(() => switchTab('history'), 1500);
                } else {
                    throw new Error(result.error.message);
                }
            } catch (e) {
                alert("Gagal: " + e.message);
            } finally {
                hideToast();
                btn.disabled = false;
            }
        }

        // FITUR 4: Status Check (Ready/Building)
        async function checkStatus(id, token, elementId) {
            const el = document.getElementById(elementId);
            el.innerText = "Checking...";
            try {
                const res = await fetch(`https://api.vercel.com/v13/deployments/${id}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();
                el.innerText = data.readyState; // READY, BUILDING, ERROR
                el.className = `text-[10px] px-2 py-1 rounded-full ${data.readyState === 'READY' ? 'bg-green-500/20 text-green-400' : 'bg-yellow-500/20 text-yellow-400'}`;
            } catch { el.innerText = "OFFLINE"; }
        }

        // FITUR 1: Hapus Project
        async function deleteProject(id, token, projectName) {
            if(!confirm(`Hapus project ${projectName}? Ini akan menghapus deployment secara permanen.`)) return;
            
            showToast("ðŸ—‘ï¸ Menghapus...");
            try {
                await fetch(`https://api.vercel.com/v13/deployments/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                historyData = historyData.filter(item => item.id !== id);
                localStorage.setItem('vercel_suite_history', JSON.stringify(historyData));
                renderHistory();
            } catch (e) { alert("Gagal hapus"); }
            hideToast();
        }

        function saveHistory(name, id, token) {
            historyData.unshift({ name, id, token, url: `https://${name}.vercel.app`, date: new Date().toLocaleDateString() });
            localStorage.setItem('vercel_suite_history', JSON.stringify(historyData));
            renderHistory();
        }

        function renderHistory() {
            const grid = document.getElementById('historyGrid');
            grid.innerHTML = historyData.map((item, i) => `
                <div class="glass p-6 rounded-3xl relative group border-white/5 hover:border-white/20 transition-all">
                    <div class="flex justify-between items-start mb-4">
                        <span id="status-${i}" class="text-[10px] bg-white/10 px-2 py-1 rounded-full">CHECKING</span>
                        <button onclick="deleteProject('${item.id}', '${item.token}', '${item.name}')" class="text-gray-600 hover:text-red-500 transition">
                            <i class="fa-solid fa-trash-can"></i>
                        </button>
                    </div>
                    <h3 class="font-bold text-white mb-1 truncate">${item.name}</h3>
                    <p class="text-[10px] text-gray-500 uppercase tracking-widest mb-4">${item.date}</p>
                    <div class="flex gap-2">
                        <a href="${item.url}" target="_blank" class="flex-grow bg-white text-black text-center py-2 rounded-lg text-xs font-bold hover:bg-blue-500 hover:text-white transition">Visit Site</a>
                        <button onclick="checkStatus('${item.id}', '${item.token}', 'status-${i}')" class="px-3 bg-white/10 rounded-lg hover:bg-white/20"><i class="fa-solid fa-rotate-right text-xs"></i></button>
                    </div>
                </div>
            `).join('');
            
            // Auto check status saat render
            historyData.forEach((item, i) => checkStatus(item.id, item.token, `status-${i}`));
        }

        function showToast(msg) { 
            document.getElementById('toastText').innerText = msg;
            document.getElementById('toast').classList.remove('hidden'); 
        }
        function hideToast() { document.getElementById('toast').classList.add('hidden'); }
    </script>
</body>
</html>
